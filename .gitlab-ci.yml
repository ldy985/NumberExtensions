image: registry.gitlab.com/ldy985/dotnetsdk_gitversion

variables:
  GIT_SUBMODULE_STRATEGY: normal

cache:
  key: "$CI_PROJECT_NAMESPACE-$CI_PROJECT_NAME"
  paths:
    - .nuget/

stages:
- build
- test
- deploy

build:
  stage: build
  artifacts:
    expire_in: 12 hours
    paths:
      - "*/bin"
      - "*/obj"
  script:
    - bash dotnet-gitversion
    - bash ./build.sh build --for-prod

test:
  stage: test
  dependencies:
    - build
  script:
    - bash ./build.sh test
     
deploy:
  stage: deploy
  dependencies:
    - build
  artifacts:
    expire_in: 14 days
    paths:
      - artifacts
  script:
    - bash ./build.sh pack+push --for-prod --path $FEED_URL --api-key $FEED_KEY
  when: manual

